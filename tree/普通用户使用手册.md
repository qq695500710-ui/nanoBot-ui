# 普通用户使用手册（newui.exe）

本手册面向**非程序员/小白用户**，用来指导你在 Windows 上使用打包后的 `newui.exe` 来配置并使用 nanobot（开源项目放在同级 `nanobot-main/`，可随时替换更新）。

---

### 1. 你会得到哪些文件

你拿到的打包结果通常是一个文件夹（例如 `newui.dist/`），里面至少应包含：

- **`newui.exe`**：可视化控制面板（你双击打开的程序）
- **一堆依赖文件**：和 `newui.exe` 同目录（这是打包带的运行环境）
- **`nanobot-main/`（重要）**：你从开源项目下载的原始代码文件夹，放在 `newui.exe` 同级目录

推荐的目录结构（示例）：

```
newui.dist/
  newui.exe
  nanobot-main/
    nanobot/
    pyproject.toml
    requirements.txt
    ...
  (其它打包出来的依赖文件/文件夹)
```

以后 nanobot 更新：你只需要把新的开源项目下载下来，**替换 `newui.exe` 同级目录的 `nanobot-main/` 文件夹**即可。

---

### 2. 首次启动前你需要知道的“数据存放位置”

`newui.exe` 不会把配置写在程序目录里，而是写到你的用户目录（以后换位置也不丢）：

- **主配置文件**：`C:\Users\<你的用户名>\.nanobot\config.json`
- **newui 自己的日志**：`C:\Users\<你的用户名>\.nanobot\newui\newui.log`
- **技能目录（你导入/自定义的技能会在这里生效）**：`C:\Users\<你的用户名>\.nanobot\workspace\skills\`
- **定时任务数据（Cron jobs.json）**：在“定时任务”窗口会显示具体路径（通常在 `~\.nanobot\...` 下）

#### 2.1 备份/迁移（换电脑也不怕）

如果你要换电脑/重装系统，最重要的是备份这两个位置：

- `C:\Users\<你>\.nanobot\config.json`（你的所有配置：API Key、社交平台配置、MCP 配置等）
- `C:\Users\<你>\.nanobot\workspace\`（你的技能、工作文件）

新电脑上只要把这两个拷过去（路径不变），再把 `newui.dist/` 解压到任意目录即可。

---

### 3. 打开 newui.exe 后主界面怎么用（最常用）

主界面右侧是会话聊天区，顶部有“提供商/模型”，右上有“设置”按钮。

#### 3.1 第一次必须做：设置 API Key

- 点击 **“设置”** → 找到 **“设置 API Key”**（或相关入口）
- 选择你使用的模型提供商（例如 openrouter / openai / custom 等）
- 填入 API Key（按界面提示）
- 保存

保存后，回到会话窗口，直接发送一句“你好”测试。

#### 3.1.1 更详细：怎样配置“AI 接口/模型”（照着填）

打开 **“设置 LLM 提供商”** 后，你会看到 4 个关键输入框：

- **当前提供商（Active Provider）**：下拉选择，例如 `OpenRouter (openrouter)`、`OpenAI (openai)`、`DeepSeek (deepseek)`、`Custom (custom)` 等
- **API Key**：直接粘贴你的 key
- **API Base URL（可选）**：
  - 只有当你使用“自定义接口 / 第三方转发 / 本地模型服务”时才需要填
  - 这类接口通常要求以 **`/v1`** 结尾（程序会自动帮你补）
- **默认模型**：推荐先用预设；保存后会写进 `agents.defaults.model`

界面里还有两个非常有用的按钮：

- **测试连接**：会用你当前填写的参数，发一句 “Say OK” 做真实测试
- **保存**：保存后会自动重启内嵌 Agent（让配置立刻生效）

下面是最常见的几种填法：

##### A) OpenRouter（最常用的“聚合网关”）

1) Active Provider 选：`OpenRouter (openrouter)`
2) API Key 粘贴：一般以 `sk-or-` 开头
3) API Base 通常不用填（留空即可）
4) 默认模型填一个你在 OpenRouter 上可用的，例如：
   - `anthropic/claude-opus-4-5`

##### B) OpenAI（直接用 OpenAI）

1) Active Provider 选：`OpenAI (openai)`
2) API Key 粘贴你的 OpenAI Key
3) API Base 留空（除非你用的是 Azure/代理/兼容接口）
4) 默认模型：例如 `gpt-4o-mini`（示例）

##### C) DeepSeek（直接用 DeepSeek）

1) Active Provider 选：`DeepSeek (deepseek)`
2) API Key 填 DeepSeek 的 key
3) **不要把 API Base 填成 openrouter.ai**（界面也会提示你不要混配）
4) 默认模型按你账号可用填写（示例：`deepseek/deepseek-chat`）

##### D) Custom（自定义接口 / 本地模型 / 第三方 OpenAI 兼容接口）

1) Active Provider 选：`Custom (custom)`
2) API Key：如果你的接口需要鉴权就填；如果不需要也可以随便填一个非空字符串（有些服务要求必须有 key 字段）
3) API Base：填你的接口地址，通常类似：
   - `http://127.0.0.1:8000/v1`
   - `https://xxx.your-domain.com/v1`
4) 默认模型：填你服务端支持的模型名（有的叫 `gpt-4o-mini`，有的叫 `llama3`，以你的服务为准）

##### E) “沐石林AI (custom)”这类预设

如果下拉里出现类似 **“沐石林AI (custom)”** 的条目：

- 选中它后，程序会自动帮你填好 `apiBase` 和默认模型
- 你只需要粘贴你自己的 API Key，然后“测试连接”→“保存”

#### 3.1.2 主界面快速切换“提供商/模型”（不改 key）

主界面聊天窗口顶部有：

- **提供商**（下拉）
- **模型**（输入框）
- **切换**（按钮）

用途：

- 你已经在“设置 API Key”里保存过 key 后，可以在这里快速切换模型
- 切换后程序会自动重启内嵌 Agent，让新模型立刻生效

注意：

- 如果你选了某个提供商但它还没配置 API Key，点“切换”会提示你先去“设置 API Key”。

#### 3.2 日常聊天

- 在输入框输入内容 → 点 **“发送”**
- 左侧 Sessions 是会话列表：
  - **“+ 新会话”**：新建一个干净对话
  - 右键会话：可重命名/删除

#### 3.3 底部“操作状态栏”（很重要）

会话窗口底部会显示类似：

- `操作：空闲（点击查看详情/日志）`
- 或 `操作中 00:12：正在...（点击查看详情/日志）`

你可以：

- **左键点击状态栏**：打开“详情/日志”窗口（适合小白看到程序正在做什么，避免误以为卡住）
- **右键点击状态栏**：打开主页链接（用于快速打开相关网站）

#### 3.4 “设置”按钮里通常有哪些入口

右上角 **“设置”** 里一般包含这些常用功能（不同版本可能略有调整）：

- **设置 API Key**：配置大模型 Key / 接口地址
- **安装依赖（pip）**：缺什么库就装什么库
- **配置社交平台**：Telegram/Slack/Email/Mochat 等
- **启动网关 / 停止网关**：让社交平台消息能进来
- **定时任务**：到点自动做事
- **记忆管理**：编辑长期记忆 `MEMORY.md` 和历史 `HISTORY.md`
- **技能管理**：启用/导入/自定义技能（SKILL.md）
- **MCP Servers**：接入外部工具服务器（mcp_* 工具）
- **打开配置目录**：快速打开 `C:\Users\<你>\.nanobot\`（配置都在这里）

---

### 4. 配置社交平台（Telegram / Slack / Email / Mochat 等）

点击 **“配置社交平台”**：

- 选择平台（例如 Telegram）
- 填基础字段（例如 Token、allowFrom 等）
- **如果你选的是 Telegram / Slack / Email / Mochat**：界面会**自动展开“高级字段（可选）”**  
  这些高级字段用来满足更复杂的配置场景；不会影响你只填基础字段的简单用法。
- 点 **“保存”**

保存后，你就可以点击主界面的 **“启动网关”** 让机器人开始在社交平台里工作。

#### 4.1 Telegram（最推荐）

你在向导里会看到字段：

- `Bot Token`
- `允许用户(可选,逗号分隔)`（allowFrom）

获取与填写步骤：

1) 打开向导里给的链接：`https://t.me/BotFather`
2) 在 Telegram 搜索并打开 `@BotFather`
3) 发送 `/newbot`，按提示创建机器人
4) BotFather 会返回一串 token，复制粘贴到 **Bot Token**
5) （可选但强烈推荐）填写 allowFrom：
   - 写你自己的 Telegram 用户 ID（或允许的用户 ID），多个用逗号分隔
   - 作用：只允许指定用户和你的机器人对话，避免陌生人乱用
6) 保存 → 回主界面点 **启动网关**

#### 4.2 Slack（Socket Mode）

向导里字段：

- `Bot Token(xoxb-...)`
- `App Token(xapp-...)`

大致步骤（简化版）：

1) 打开向导链接：`https://api.slack.com/apps`
2) Create New App（From scratch）
3) 开启 **Socket Mode**，生成 **App-Level Token**（通常以 `xapp-` 开头）
4) OAuth & Permissions 里安装 App 到 Workspace，拿到 **Bot Token**（通常以 `xoxb-` 开头）
5) 把两个 token 填回向导保存
6) 启动网关后，在 Slack 里 @机器人或私聊它测试

#### 4.3 Email（IMAP/SMTP）

向导里字段：

- `IMAP Host` / `IMAP 用户名` / `IMAP 密码/应用专用密码`
- `SMTP Host` / `SMTP 用户名` / `SMTP 密码/应用专用密码`
- `发件人地址`

建议（小白更容易成功）：

- 先准备一个“专用邮箱”给机器人用，不要用你的主邮箱
- 如果是 Gmail：通常需要开启“两步验证”后创建“应用专用密码”，用它当 IMAP/SMTP 密码

填完保存后启动网关，机器人会轮询收件箱并按配置回复。

#### 4.4 Mochat（Claw IM）

向导里字段：

- `claw_token`
- `agent_user_id`

把你在 Mochat 平台拿到的这两个值填进去保存即可，然后启动网关。

#### 4.5 WhatsApp（需要 bridge）

向导里字段：

- `bridge ws url (默认 ws://localhost:3001)`

说明（小白版结论）：

- WhatsApp 需要先在电脑上跑一个 bridge（通常是 Node.js 程序），并完成扫码登录
- 然后把 bridge 的 ws 地址填进来（默认一般是 `ws://localhost:3001`）

#### 4.6 其它平台（飞书 / 钉钉 / Discord / QQ）

这几项在向导里都会给你“官方入口链接”，你照着平台的开发者控制台创建应用/机器人，拿到对应字段填回即可：

- **飞书**（长连接机器人）：
  - 打开向导里的飞书链接 → 创建应用 → 开启“机器人”能力
  - 在“凭证/基本信息”里复制 `App ID` / `App Secret`
  - 填回向导保存 → 启动网关 → 去飞书里给机器人发消息测试
- **钉钉**（Stream Mode 机器人）：
  - 打开向导里的钉钉链接 → 创建机器人/应用 → 开启 Stream/长连接相关能力
  - 复制 `Client ID(AppKey)` / `Client Secret`
  - 填回向导保存 → 启动网关测试
- **Discord**：
  - 打开向导里的 Discord Developer Portal → Create Application → Bot → 复制 `Bot Token`
  - 填回向导保存 → 把机器人邀请进你的服务器/或私聊它测试
  - （可选）如果你只想让自己能用：在 allowFrom 里填你的用户 ID（逗号分隔）
- **QQ（QQ 单聊机器人）**：
  - 打开向导里的 QQ 开放平台 → 创建机器人应用 → 复制 `App ID` / `App Secret`
  - 填回向导保存 → 启动网关测试

---

### 5. 启动/停止网关（让社交平台消息进来）

主界面按钮：

- **“启动网关”**：开始运行网关（会读取你在 `config.json` 里启用的 channels）
- **“停止网关”**：停止网关

如果你修改了“定时任务”或某些配置，程序可能会提示你**需要重启网关才能生效**（这是正常的：网关运行时会把任务读进内存）。

---

### 6. 定时任务（Cron）：让机器人“到点自动做事”

点击 **“定时任务”**：

- **一次性任务**：勾选“只执行一次”，设置时间（`YYYY-MM-DD HH:MM`）
- **重复任务**：取消勾选“只执行一次”，填写“重复间隔（秒）”
- “消息内容”就是到点后给 nanobot 的一句话  
  例如：
  - `提醒我喝水`
  - `打开记事本`
  - `帮我检查今天日程`

窗口里还有：

- “任务列表”：可刷新/删除
- “后台任务面板”：查看模型用 `spawn` 启动的后台任务是否还在运行

---

### 7. 技能管理：让机器人学会“某一种固定能力”

点击 **“技能管理”**，你会看到：

- 技能列表（内置 / workspace）
- 右侧预览 `SKILL.md`

常用操作：

- **启用内置技能**：选一个技能 → 点“启用（复制内置到 workspace）”
- **导入技能文件夹**：你从社区下载一个技能文件夹（里面必须有 `SKILL.md`）→ 导入
- **新建自定义技能**：自动生成一个模板，你按模板写规则即可
- **打开 skills 目录**：直接打开 `~\.nanobot\workspace\skills\` 方便你复制文件

用技能的方法（最简单）：

- 回到聊天里说：**“按技能 XXX 做……”**  
  机器人会读取技能的 `SKILL.md` 来执行。

---

### 7.5 记忆管理：让机器人“记住”你的偏好（可选但推荐）

点击 **“记忆管理”**，你会看到两个文件：

- **`MEMORY.md`**：长期记忆（例如你的偏好、常用信息）。它会在每次对话时都被读取。
- **`HISTORY.md`**：历史记录（更像日志）。适合记一些发生过的事情，方便以后检索。

小白推荐写法（简单、好维护）：

- 在 `MEMORY.md` 里每一条记忆写成一行，例如：
  - `- 我更喜欢中文回答`
  - `- 我常用的默认模型是 xxx`
  - `- 我所在时区是 Asia/Shanghai`

修改后点“保存”即可生效。

---

### 8. MCP Servers：接入“外部工具服务器”（高级）

点击 **“MCP Servers”**：

- 你可以新增多个 MCP server（两种方式）：
  - **stdio**：填 `command` + `args`（nanobot 连接时会自动启动这个进程并走 stdio 通信）
  - **HTTP**：填 `url`（需要你先在外部把 server 跑起来）
- 配置好后点 **“测试连接/列出工具”**  
  成功后会出现工具名：`mcp_<serverName>_<toolName>`

回到聊天里用 MCP 工具：

- 直接说：**“帮我用 <serverName> 的 <toolName> 做 xxx”**
- 或明确指定：**“使用工具 mcp_<serverName>_<toolName>，参数为 {...}”**

---

### 9. 设置 → 安装依赖（非常关键：缺什么装什么）

当你看到聊天里出现类似：

- `Error: agent not ready (failed). No module named 'xxx'`

说明 nanobot 更新后需要新依赖，或者你启用了某个技能/MCP/功能需要额外库。

解决办法：

1) 点击 **“设置”** → **“安装依赖（pip）”**  
2) 在输入框输入缺少的依赖（例如 `pydantic-settings`、`playwright`、`selenium`）  
3) 点 **“安装”**  
4) 安装完成后 **重启 newui.exe**

小白只需要记住一句话：**缺什么装什么，装完重启**。

---

### 10. 怎样“对接你电脑里已有的程序”（exe / 脚本 / 批处理）

你可以把 nanobot 当作“会聊天的自动化助手”。常见对接方式有两种：

#### 方式 A：直接在聊天里让它运行（最简单）

在会话里说清楚你要运行什么，例如：

- “帮我打开 `C:\Program Files\xxx\xxx.exe`”
- “帮我运行桌面的 `记账工具.exe`”
- “帮我执行这个 bat：`C:\tools\do_something.bat`”

如果你的电脑安全策略允许，nanobot 会尝试执行并把过程写入日志（底部状态栏可点开看详情）。

#### 方式 B：用“定时任务”在某个时间自动运行

打开 **“定时任务”**，把“消息内容”写成一句明确指令，例如：

- “打开记事本并新建一个 todo.txt”
- “运行 `D:\tools\backup.exe` 做备份”

到点后，nanobot 会把这句话当成任务执行。

安全提示（建议小白必读）：

- 不要让机器人执行来历不明的程序/脚本。
- 涉及重要文件前，先手动备份。

---

### 11. 常见问题排查

#### 11.1 “agent not ready / 缺少模块”

- 去 **设置 → 安装依赖** 安装提示的模块名
- 安装后 **重启 newui.exe**

#### 11.2 “网关启动了但社交平台不回复”

- 先确认你在 **配置社交平台** 里已保存正确 token/账号信息
- 确认该平台配置里是 `enabled=true`
- 尝试 **停止网关 → 再启动网关**
- 打开日志：**左键点击底部状态栏** → 查看报错

#### 11.3 “看起来卡住了”

- 看底部 **操作状态栏** 是否显示“操作中…”
- **左键点状态栏**打开详情/日志，一般能看到正在做什么

---

### 12. 重要概念（简单解释）

- **会话（Sessions）**：不同聊天的“记忆隔离”。做不同事情建议分开新建会话。
- **网关（Gateway）**：让社交平台（Telegram/Slack/Email 等）能把消息发给机器人、机器人也能回复。
- **技能（Skills）**：一份说明书（`SKILL.md`），教机器人“固定套路怎么做”。
- **MCP Server**：一个外部工具服务，接进来后会变成 `mcp_*` 工具，机器人可以调用它做事。

