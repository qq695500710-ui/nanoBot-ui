# 一般使用者使用手冊（newui.exe）

本手冊面向**非程式設計師 / 新手使用者**，用來指導你在 Windows 上使用打包後的 `newui.exe` 來設定並使用 nanobot（開源專案放在同級 `nanobot-main/`，可隨時替換更新）。

---

### 1. 你會拿到哪些檔案

你拿到的打包結果通常是一個資料夾（例如 `newui.dist/`），裡面至少應包含：

- **`newui.exe`**：視覺化控制面板（雙擊開啟）
- **一堆依賴檔案**：和 `newui.exe` 同目錄（這是打包自帶的執行環境）
- **`nanobot-main/`（重要）**：你從官方開源專案下載的原始碼資料夾，放在 `newui.exe` 同級目錄

建議目錄結構（範例）：

```
newui.dist/
  newui.exe
  nanobot-main/
    nanobot/
    pyproject.toml
    requirements.txt
    ...
  (其它打包出來的依賴檔/資料夾)
```

以後 nanobot 更新：你只需要重新下載官方專案，**替換 `newui.exe` 同級目錄的 `nanobot-main/` 資料夾**即可。

---

### 2. 首次啟動前你需要知道的「資料存放位置」

`newui.exe` 不會把設定寫在程式目錄裡，而是寫到你的使用者目錄（以後換位置也不會丟）：

- **主設定檔**：`C:\Users\<你的使用者名稱>\.nanobot\config.json`
- **newui 日誌**：`C:\Users\<你的使用者名稱>\.nanobot\newui\newui.log`
- **技能目錄（匯入/自訂技能會在這裡生效）**：`C:\Users\<你的使用者名稱>\.nanobot\workspace\skills\`
- **排程任務資料（Cron jobs.json）**：在「排程任務」視窗會顯示具體路徑（通常在 `~\.nanobot\...`）

#### 2.1 備份 / 搬移（換電腦也不怕）

換電腦/重裝時，最重要是備份這兩個位置：

- `C:\Users\<你>\.nanobot\config.json`（所有設定：API Key、社群平台設定、MCP 設定等）
- `C:\Users\<你>\.nanobot\workspace\`（你的技能、工作檔）

新電腦只要把這兩個拷回去（路徑不變），再把 `newui.dist/` 解壓到任意位置即可。

---

### 3. 開啟 newui.exe 後怎麼用（最常用）

主介面右側是會話聊天區，頂部有「提供商/模型」，右上角有「設定」按鈕。

#### 3.1 第一次必做：設定 API Key

- 點 **「設定」** → 找到 **「設定 API Key」**
- 選擇你使用的模型提供商（例如 openrouter / openai / custom）
- 貼上 API Key
- 儲存

儲存後回到會話視窗，先傳一句「你好」測試。

#### 3.1.1 更詳細：如何設定「AI 介面 / 模型」（照著填）

開啟 **「設定 LLM 提供商」** 後，你會看到 4 個關鍵欄位：

- **目前提供商（Active Provider）**：下拉選擇，例如 `OpenRouter (openrouter)`、`OpenAI (openai)`、`DeepSeek (deepseek)`、`Custom (custom)` 等
- **API Key**：直接貼上你的 key
- **API Base URL（選填）**：
  - 只有你使用「自訂介面 / 第三方轉發 / 本地模型服務」時才需要填
  - 這類介面通常要求以 **`/v1`** 結尾（程式會自動幫你補）
- **預設模型**：建議先保留預設；儲存後會寫入 `agents.defaults.model`

介面上還有兩個很重要的按鈕：

- **測試連線**：用你目前填的參數送一句 “Say OK” 做真實測試
- **儲存**：儲存後會自動重啟內嵌 Agent（讓設定立刻生效）

常見填法：

##### A) OpenRouter（最常用的聚合網關）

1) Active Provider：`OpenRouter (openrouter)`
2) API Key：通常以 `sk-or-` 開頭
3) API Base：通常留空即可
4) 預設模型：例如 `anthropic/claude-opus-4-5`

##### B) OpenAI（直接用 OpenAI）

1) Active Provider：`OpenAI (openai)`
2) API Key：貼上 OpenAI Key
3) API Base：留空（除非你用 Azure/代理/相容介面）
4) 預設模型：例如 `gpt-4o-mini`（示例）

##### C) DeepSeek（直接用 DeepSeek）

1) Active Provider：`DeepSeek (deepseek)`
2) API Key：貼 DeepSeek 的 key
3) **不要把 API Base 填成 openrouter.ai**
4) 預設模型：例如 `deepseek/deepseek-chat`（示例）

##### D) Custom（自訂介面 / 本地模型 / OpenAI 相容介面）

1) Active Provider：`Custom (custom)`
2) API Key：你的介面若需要鑑權就填；不需要也可填任意非空字串（有些服務要求必填）
3) API Base：例如：
   - `http://127.0.0.1:8000/v1`
   - `https://xxx.your-domain.com/v1`
4) 預設模型：填你服務端支援的模型名（以你的服務為準）

##### E) 類似「沐石林AI (custom)」的預設

如果下拉裡有類似 **「沐石林AI (custom)」**：

- 選中後會自動填好 `apiBase` 與預設模型
- 你只要貼上自己的 API Key，按「測試連線」→「儲存」

#### 3.1.2 主介面快速切換「提供商/模型」（不改 Key）

主介面聊天區頂部有：

- **提供商**（下拉）
- **模型**（輸入框）
- **切換**（按鈕）

用途：

- 你已在「設定 API Key」裡保存過 key 後，可在此快速切換模型
- 切換後會自動重啟內嵌 Agent

注意：

- 若某提供商尚未設定 API Key，點「切換」會提示你先去設定。

#### 3.2 日常聊天

- 輸入文字 → 點 **「送出」**
- 左側 Sessions 是會話列表：
  - **「+ 新會話」**：新建乾淨對話
  - 右鍵會話：可重新命名/刪除

#### 3.3 底部「操作狀態列」（很重要）

會話視窗底部會顯示：

- `操作：空閒（點擊查看詳情/日誌）`
- 或 `操作中 00:12：正在...（點擊查看詳情/日誌）`

你可以：

- **左鍵點擊狀態列**：開啟「詳情/日誌」視窗（避免誤以為卡住）
- **右鍵點擊狀態列**：開啟首頁連結

#### 3.4 「設定」按鈕裡通常有哪些入口

右上角 **「設定」** 裡通常包含：

- **設定 API Key**：設定模型 Key / 介面
- **安裝依賴（pip）**：缺什麼裝什麼
- **設定社群平台**：Telegram/Slack/Email/Mochat 等
- **啟動網關 / 停止網關**
- **排程任務**
- **記憶管理**：`MEMORY.md` / `HISTORY.md`
- **技能管理**
- **MCP Servers**
- **開啟設定資料夾**

---

### 4. 設定社群平台（Telegram / Slack / Email / Mochat 等）

點 **「設定社群平台」**：

- 選平台
- 填基本欄位
- **若選 Telegram / Slack / Email / Mochat**：會自動展開「進階欄位（可選）」
- 點 **「儲存」**

儲存後回主介面點 **「啟動網關」**，讓機器人在社群平台裡開始工作。

#### 4.1 Telegram（最推薦）

向導欄位：

- `Bot Token`
- `allowFrom（可選，逗號分隔）`

步驟：

1) 開啟 `https://t.me/BotFather`
2) 在 Telegram 打開 `@BotFather`
3) 發 `/newbot` 建立 bot
4) 複製 token 貼到 **Bot Token**
5) （可選）填 allowFrom：只允許指定使用者使用
6) 儲存 → 回主介面啟動網關

#### 4.2 Slack（Socket Mode）

向導欄位：

- `Bot Token(xoxb-...)`
- `App Token(xapp-...)`

大致步驟：

1) `https://api.slack.com/apps` 建立 App
2) 開啟 **Socket Mode** 產生 `xapp-...`
3) 安裝到 Workspace 取得 `xoxb-...`
4) 填回向導儲存 → 啟動網關測試

#### 4.3 Email（IMAP/SMTP）

向導欄位：

- IMAP/SMTP Host、帳號、密碼（可能是「應用程式專用密碼」）
- `fromAddress`

建議：

- 用專用信箱
- Gmail 通常要開兩步驗證後建立 App Password

#### 4.4 Mochat（Claw IM）

向導欄位：

- `claw_token`
- `agent_user_id`

填入後儲存 → 啟動網關。

#### 4.5 WhatsApp（需要 bridge）

向導欄位：

- `bridge ws url (預設 ws://localhost:3001)`

說明：

- 需先在電腦上跑 bridge（多為 Node.js）並完成掃碼登入
- 再把 ws 位址填進來

#### 4.6 其它平台（飛書 / 釘釘 / Discord / QQ）

向導會給官方入口連結，你依平台建立機器人後把欄位填回：

- **飛書**：`App ID` + `App Secret`（儲存後啟動網關測試）
- **釘釘**：`Client ID(AppKey)` + `Client Secret`
- **Discord**：`Bot Token`（可選 allowFrom 限制）
- **QQ**：`App ID` + `App Secret`

---

### 5. 啟動 / 停止網關（讓社群平台訊息進來）

- **啟動網關**：會讀取 `config.json` 中已啟用的 channels
- **停止網關**

如果你修改了排程任務或部分設定，程式可能提示你需要**重啟網關**才會生效（正常現象：網關會把任務讀進記憶體）。

---

### 6. 排程任務（Cron）：到點自動做事

點 **「排程任務」**：

- **只執行一次**：勾選，設定時間（`YYYY-MM-DD HH:MM`）
- **重複任務**：取消勾選，填「重複間隔（秒）」

「訊息內容」就是到點後給 nanobot 的一句話，例如：

- `提醒我喝水`
- `打開記事本`

---

### 7. 技能管理：讓機器人學會固定能力

點 **「技能管理」**：

- 可啟用內建技能（複製到 workspace）
- 可匯入技能資料夾（必須有 `SKILL.md`）
- 可新建自訂技能（模板）

使用技能：

- 回到聊天說：**「按技能 XXX 做……」**

---

### 7.5 記憶管理（推薦）

點 **「記憶管理」**：

- `MEMORY.md`：長期記憶（每次對話都會讀）
- `HISTORY.md`：歷史記錄（偏日誌）

建議在 MEMORY.md 每條一行，例如：

- `- 我更喜歡中文回答`
- `- 我所在時區是 Asia/Shanghai`

---

### 8. MCP Servers（進階）

在 **「MCP Servers」** 可新增：

- **stdio**：填 `command` + `args`（nanobot 連線時自動啟動）
- **HTTP**：填 `url`（外部需先跑起 server）

測試：

- 按「測試連線/列出工具」後會看到工具名：`mcp_<serverName>_<toolName>`

使用：

- 「幫我用 `<serverName>` 的 `<toolName>` 做 xxx」

---

### 9. 設定 → 安裝依賴（缺什麼裝什麼）

當你看到：

- `No module named 'xxx'`

就去 **設定 → 安裝依賴（pip）**：

1) 輸入缺少的依賴名（例如 `pydantic-settings`）
2) 按「安裝」
3) 安裝完成後 **重啟 newui.exe**

---

### 10. 對接你電腦已有的程式（exe / bat）

你可以直接在聊天裡說：

- 「幫我打開 `C:\Program Files\xxx\xxx.exe`」
- 「幫我執行 `C:\tools\do_something.bat`」

也可以用排程任務到點自動執行。

安全提醒：

- 不要執行來路不明的程式/腳本
- 重要檔案先備份

---

### 11. 常見問題

#### 11.1 agent not ready / 缺少模組

- 去安裝依賴補裝缺的模組
- 重啟 newui.exe

#### 11.2 網關啟動了但不回覆

- 檢查社群平台 token/欄位是否正確
- 停止網關 → 再啟動
- 左鍵點底部狀態列查看日誌

---

### 12. 名詞小抄

- **Sessions**：不同會話的記憶隔離
- **Gateway**：讓社群平台訊息進出
- **Skills**：用 `SKILL.md` 教機器人固定流程
- **MCP Server**：外部工具服務（提供 `mcp_*` 工具）

